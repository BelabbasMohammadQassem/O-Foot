{% extends 'base.html.twig' %}

{% block title %}O'FOOT - Modifier les Résultats{% endblock %}

{% block body %}
<div class="container mt-4 custom-contact-container">
    <div class="row">
        <div class="col text-center">
            <div class="rounded-pill bg-dark d-inline-block p-3">
                <h2 class="section-title m-0">Modifier les Résultats du Tournoi</h2>
            </div>
        </div>
    </div>

    <div class="accordion mt-4" id="tournamentAccordion">

        <!-- Huitièmes de finale -->
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="headingEight">
                <button class="accordion-button text-center" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight" aria-expanded="true" aria-controls="collapseEight">
                    Huitièmes de finale
                </button>
            </h2>
            <div id="collapseEight" class="accordion-collapse collapse show" aria-labelledby="headingEight" data-bs-parent="#tournamentAccordion">
                <div class="accordion-body">
                    <div class="round">
                        {% for i in 1..8 %}
                        <div class="match">
                            <div class="match-header">Match {{ i }}</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match{{ i }}" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match{{ i }}" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time1-match{{ i }}" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match{{ i }}" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 update-score-btn" data-match="{{ i }}">Mettre à jour le score</button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quarts de finale -->
        <!-- ... (même structure que les huitièmes, mais avec i de 9 à 12) ... -->

        <!-- Demi-finales -->
        <!-- ... (même structure, mais avec i de 13 à 14) ... -->

        <!-- Finale et petite finale -->
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="headingFinal">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFinal" aria-expanded="false" aria-controls="collapseFinal">
                    Finale et Petite Finale
                </button>
            </h2>
            <div id="collapseFinal" class="accordion-collapse collapse" aria-labelledby="headingFinal" data-bs-parent="#tournamentAccordion">
                <div class="accordion-body">
                    <div class="round">
                        <!-- Petite finale -->
                        <div class="match" id="thirdPlaceMatch">
                            <div class="match-header">Petite finale</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match15" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match15" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time-match15" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match15" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 update-score-btn" data-match="15">Mettre à jour le score</button>
                        </div>

                        <!-- Finale -->
                        <div class="match" id="finalMatch">
                            <div class="match-header">Finale</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match16" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match16" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time-match16" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match16" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 update-score-btn" data-match="16">Mettre à jour le score</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
   document.querySelectorAll('.update-score-btn').forEach(button => {
    button.addEventListener('click', async function() {
        const matchId = this.getAttribute('data-match');
        const score = document.getElementById(`result1-match${matchId}`).value;

        try {
            const response = await fetch(`http://localhost:8000/api/score/update/${matchId}`, {
            method: 'PATCH',
            headers: {
        'Content-Type': 'application/json',
             },
                body: JSON.stringify({
                    score: score
                })
            });

            const responseText = await response.text(); // Obtenez le texte brut de la réponse
            console.log('Réponse brute:', responseText); // Affichez la réponse brute dans la console

            let data;
            try {
                data = JSON.parse(responseText); // Essayez de parser le JSON
            } catch (parseError) {
                console.error('Erreur lors du parsing JSON:', parseError);
                alert('La réponse du serveur n\'est pas un JSON valide');
                return;
            }

            if (response.ok) {
                alert(`Score mis à jour avec succès! Match ID: ${matchId}`);
            } else {
                alert(`Erreur lors de la mise à jour du score: ${data.error || 'Erreur inconnue'}`);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Une erreur est survenue lors de la mise à jour du score.');
        }
    });
});
</script>
{% endblock %}