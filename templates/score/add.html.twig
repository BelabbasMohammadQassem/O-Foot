{% extends 'base.html.twig' %}

{% block title %}O'FOOT - Résultats{% endblock %}

{% block body %}
<div class="container mt-4 custom-contact-container">
    <div class="row">
        <div class="col text-center">
            <div class="rounded-pill bg-dark d-inline-block p-3">
                <h2 class="section-title m-0">Résultats du Tournoi</h2>
            </div>
        </div>
    </div>

    <div class="accordion mt-4" id="tournamentAccordion">

        <!-- Huitièmes de finale -->
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="headingEight">
                <button class="accordion-button text-center" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight" aria-expanded="true" aria-controls="collapseEight">
                    Huitièmes de finale
                </button>
            </h2>
            <div id="collapseEight" class="accordion-collapse collapse show" aria-labelledby="headingEight" data-bs-parent="#tournamentAccordion">
                <div class="accordion-body">
                    <div class="round">
                        {% for i in 1..8 %}
                        <div class="match">
                            <div class="match-header">Match {{ i }}</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match{{ i }}" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match{{ i }}" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time1-match{{ i }}" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match{{ i }}" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 send-score-btn" data-match="{{ i }}">Envoyer le score</button>
                            <a href="{{ path('app_tournament_update', {'id': i}) }}" class="btn btn-secondary mt-2">Modifier</a>

                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quarts de finale -->
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="headingQuarter">
                <button class="accordion-button collapsed text-center" type="button" data-bs-toggle="collapse" data-bs-target="#collapseQuarter" aria-expanded="false" aria-controls="collapseQuarter">
                    Quarts de finale
                </button>
            </h2>
            <div id="collapseQuarter" class="accordion-collapse collapse" aria-labelledby="headingQuarter" data-bs-parent="#tournamentAccordion">
                <div class="accordion-body">
                    <div class="round">
                        {% for i in 9..12 %}
                        <div class="match">
                            <div class="match-header">Quart de finale {{ i - 8 }}</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match{{ i }}" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match{{ i }}" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time1-match{{ i }}" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match{{ i }}" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 send-score-btn" data-match="{{ i }}">Envoyer le score</button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Demi-finales -->
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="headingSemi">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSemi" aria-expanded="false" aria-controls="collapseSemi">
                    Demi-finales
                </button>
            </h2>
            <div id="collapseSemi" class="accordion-collapse collapse" aria-labelledby="headingSemi" data-bs-parent="#tournamentAccordion">
                <div class="accordion-body">
                    <div class="round">
                        {% for i in 13..14 %}
                        <div class="match">
                            <div class="match-header">Demi-finale {{ i - 12 }}</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match{{ i }}" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match{{ i }}" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time1-match{{ i }}" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match{{ i }}" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 send-score-btn" data-match="{{ i }}">Envoyer le score</button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Finale et petite finale -->
        <div class="accordion-item mb-2">
            <h2 class="accordion-header" id="headingFinal">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFinal" aria-expanded="false" aria-controls="collapseFinal">
                    Finale et Petite Finale
                </button>
            </h2>
            <div id="collapseFinal" class="accordion-collapse collapse" aria-labelledby="headingFinal" data-bs-parent="#tournamentAccordion">
                <div class="accordion-body">
                    <div class="round">
                        <!-- Petite finale -->
                        <div class="match" id="thirdPlaceMatch">
                            <div class="match-header">Petite finale</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match15" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match15" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time-match15" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match15" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 send-score-btn" data-match="15">Envoyer le score</button>
                        </div>

                        <!-- Finale -->
                        <div class="match" id="finalMatch">
                            <div class="match-header">Finale</div>
                            <div class="teams">
                                <input class="input" type="text" id="team1-match16" placeholder="Équipe 1" readonly>
                                <input class="input" type="text" id="team2-match16" placeholder="Équipe 2" readonly>
                            </div>
                            <div class="time">
                                <input type="time" id="time-match16" placeholder="Heure" readonly>
                            </div>
                            <div class="result">
                                <input class="input" type="text" id="result1-match16" placeholder="Résultat">
                            </div>
                            <button class="btn btn-primary mt-2 send-score-btn" data-match="16">Envoyer le score</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // Attendre que le DOM soit entièrement chargé avant d'exécuter le script
    document.addEventListener('DOMContentLoaded', function() {
        // Sélectionner tous les boutons avec la classe 'send-score-btn'
        document.querySelectorAll('.send-score-btn').forEach(button => {
            // Ajouter un écouteur d'événement 'click' à chaque bouton
            button.addEventListener('click', async function() {
                // Récupérer l'ID du match à partir de l'attribut data-match du bouton
                const matchId = this.getAttribute('data-match');
                // Récupérer la valeur du score depuis l'input correspondant
                const score = document.getElementById(`result1-match${matchId}`).value;

                try {
                    // Envoyer une requête POST à l'API
                    const response = await fetch(('http://localhost:8000/api/score/post'), {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        // Convertir les données en JSON pour l'envoi
                        body: JSON.stringify({
                            score: score
                        })
                    });

                    // Analyser la réponse JSON
                    const data = await response.json();

                    // Vérifier si la requête a réussi
                    if (response.ok) {
                        // Afficher un message de succès avec l'ID du score
                        alert(`Score enregistré avec succès! ID: ${data.id}`);
                    } else {
                        // Afficher un message d'erreur si la requête a échoué
                        alert(`Erreur lors de l'enregistrement du score: ${data.error || 'Erreur inconnue'}`);
                    }
                } catch (error) {
                    // Gérer les erreurs de réseau ou autres erreurs
                    console.error('Error:', error);
                    alert('Une erreur est survenue lors de l\'envoi du score.');
                }
            });
        });
    });


</script>
    {% endblock %}